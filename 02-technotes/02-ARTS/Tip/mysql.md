[TOC]

# 存储引擎

## MyISAM

> 不支持事务，性能更好，数据占用空间小。锁级别为表级锁，并发性差。

**数据表底层结构**

每张表对应生成三个文件

- frm文件：表结构定义文件，存储与表相关的元数据(meta)信息
- MYD文件：MyISAM存储引擎专用，存放MyISAM表的数据(data)
- MYI文件：MyISAM存储引擎专用，存放MyISAM表的索引相关信息

**mysql8.0从元数据中移除了frm文件**

**适用场景**

- 非事务型应用
- 只读类应用(可以压缩表)，存档数据

## InnoDB

> Mysql 5.7中的默认存储引擎，InnoDB是一个事务安全存储引擎。支持行级锁和表锁，支持读写并发，写不阻塞(MVCC)。InnoDB 将用户数据存储在`聚集索引`中(索引和记录在一起存储)，以减少基于主键的常见查询 I/O 。

InnoDB 对应两个文件： 表结构文件 `.frm `、数据文件 `.ibd`；表最大为 64TB。

**适用场景**

- 经常更新表，存在并发读写或者有事务处理的业务系统
- 并发业务多，需要考虑读写互不干扰，保证比较高的数据一致性的场景

## MyISAM和InnoDB对比

- 事务和外键
  - InnoDB支持事务，具有安全性和完整性，适合大量insert和update操作
  - MyISAM不支持事务，提供高速检索，适合大量select操作
- 锁机制
  - InnoDB支持行级锁和表级锁，基于索引实现
  - MyISAM只支持表级锁
- 索引结构
  - InnoDB使用**聚集索引(聚簇索引)，索引和记录在一起存储**
  - MyISAM使用**非聚集索引(非聚簇索引)，索引和记录分开存储**
- 并发处理能力
  - InnoDB读写阻塞与隔离级别有关，可以采用多版本并发控制MVCC支持高并发
  - MyISAM使用表锁，写操作并发率低，读写阻塞
- 存储文件
  - InnoDB 对应两个文件： 表结构文件 `.frm `、数据文件 `.ibd`；表最大为 64TB。
  - MyISAM 对应三个文件：表结构文件 `.frm`、表数据文件`.MYD`、索引文件`.MYI`；从 MySQL5.0 开始默认限制是 256TB
  - **mysql8.0从元数据中移除了frm文件**
- 适用场景
  - InnoDB读写阻塞与隔离级别有关，可以采用多版本并发控制MVCC支持高并发
    - 经常更新表，存在并发读写或者有事务处理的业务系统
    - 并发业务多，需要考虑读写互不干扰，保证比较高的数据一致性的场景
  - MyISAM
    - 非事务型应用
    - 只读类应用(可以压缩表)，存档数据

# 索引

## 索引的分类

索引，数据库管理系统(DBMS)的一个**排序**的数据结构，以协助快速查询、更新数据库表中的数据。

### 应用层面

- 普通索引，也叫做非唯一索引，是普通索引，没有任何限制
- 唯一索引，要求键值不重复
- 主键索引，是一种特殊的唯一索引，它还多了一个限制条件，要求**键值不能为空**。主键索引用 **Primay key**创建
- 复合索引，又称为联合索引，是在多个列上创建的索引。创建复合索引最重要的是**列顺序**的选择，这关系到索引能否使用上，或者影响多少个谓词条件能使用上索引。**复合索引的使用遵循最左匹配原则**，只有索引左边的列匹配到，后面的列才能继续匹配

### 数据与键值逻辑

- 聚集索引，**(聚簇索引)，索引和记录在一起存储**，一个索引值对应一行记录。
  - 如果一张表创建了主键索引，那么主键索引就是聚簇索引
  - 如果没有主键，则为第一个非空唯一索引
  - 没有非空唯一索引，则为 InnoDB 内置的 ROWID
- 非聚集索引，**(非聚簇索引)，索引和记录分开存储**。二级索引/辅助索引

### 数据结构

- B树
- B+树
- Hash索引
- FullText索引
- R树索引
