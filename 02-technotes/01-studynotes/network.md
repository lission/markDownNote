[TOC]

# 互联网协议

## 网络分层

从不同维度，可以由3种分类方式。

- OSI七层：
应用层、表示层、会话层、传输层、网络层、数据链路层、物理层
- TCP/IP 五层：
应用层(**应用层、表示层、会话层**)、传输层、网络层、数据链路层、物理层
- TCP/IP 四层：
应用层(应用层、表示层、会话层)、传输层、网络层、网络接口层(**数据链路层、物理层**)

## 应用层协议

- DNS
- HTTP
- FTP
- SMTP
- POP3
- Telnet

## 传输层

用来建立端口到端口的通信机制。

> 设备：四层交换机、四层路由器

### 端口

- **应用程序与网卡关联的编号**
- 取值范围：0～65535	
- 系统保留端口(BSD保留端口)：0～1023	
- 用户可注册的端口范围：1024～49151
- 随机动态端口：49152～65535

### 传输层协议

#### TCP

- **定义**：Transmission Control Protocol **传输控制协议**，一种**可靠传输协议**

- **长度**：无长度限制，但为了保证效率，通常不会超过IP数据包的长度(65535Byte)，确保单个TCP数据包不再分割。

- **数据结构：**

  > ![img](https://github.com/lission/markdownPics/blob/main/network/TCP%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84.png?raw=true)

- **交互流程**

  1. 建立连接，三次握手，客户端-服务器模式

     > 客户端-服务端模式：
     >
     > - 主动发起建立连接的应用进程叫客户端
     > - 被动等待连接建立的应用进程叫服务端
     >
     > 三次握手过程：
     >
     > 1. 客户端向服务端发送一个SYN
     > 2. 服务端接收到SYN后，向客户端发送一个SYN_ACK
     > 3. 客户端接收到SYN_ACK后，再给服务端发送一个ACK

  2. 数据传输

  3. 连接释放，四次挥手

     > 四次挥手过程：
     >
     > 1. 客户端向服务端发送一个FIN
     > 2. 服务端接收到FIN后，向客户端发送ACK，表示我接收到了断开连接请求，客户端可以不发送数据，服务端可能还有数据在处理
     > 3. 服务端处理完所有数据后，向客户端发送FIN，表示服务端现在可以断开连接了
     > 4. 客户端接收到FIN，向服务端发送ACK，表示客户端也会断开连接了

#### UDP

- **定义**：User Datagram Protocol 用户数据报协议，一种**不可靠的传输协议**

- **长度**：有长度限制，Head 8 byte，总长度不超过655535Byte，正好放进一个IP数据包

- **数据结构：**

  > ![img](https://github.com/lission/markdownPics/blob/main/network/UDP%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84.png?raw=true)

## 网络层

**定义**：引入一套新的地址来区分不同的广播域/子网，这套地址叫做网络地址

> 设备：路由器、三层交换机

### IP(网际互联协议 Internet Protocol)
- IP的作用：

  - 为每一台计算机分配IP地址
  - 确定哪些地址在同一个子网络中

- IP地址

  - IP地址分类

    - IPv4

      > 网络地址由**32位二进制数表示**
      > 通常写为**4段十进制数**
      > 取值范围0.0.0.0~255.255.255.255

    - IPv6

  - IP地址构成

    - 网络部分，用来标识子网
    - 主机部分，用来标识主机

- 子网掩码，表示子网络特征的一个参数，**形式上等同于IP地址，网络部分全为1，主机部分全为0**

  > 使用方法：将两个ip地址分别与子网掩码进行&运算，结果相同则说明两个ip在同一子网种

- IP数据包，直接放入以太网的Data部分，以太网数据包Data最长1500Byte，因此若IP数据包超过此长度， 会被分割为多个以太网数据包，分开发送

  > 构成:
  >
  > - Head，20～60Byte
  > - Data，最长65515Byte 

- ARP，用于实现从IP地址到MAC地址的映射

## 数据链路层

定义对高低电平进行分组方式

> 设备：网桥、以太网交换机、网卡

Ethernet以太网，以太网协议：

- 帧，一组电平信号构成一个数据包，叫做帧

  > 构成:
  >
  > - Head，固定18字节：
  >   - 发送者/源地址：6Byte、
  >   - 接受者/目标地址:6Byte
  >   - 数据类型：6Byte
  > - Data，最短46Byte，最长1500Byte
  > 
  > 长度：最短64字节，最长1518字节，超过此长度就分片发送
  
- MAC地址

- Broadcast广播，Ethernet**使用广播方式进行通信**

## 物理层

高电平用1表示，低电平用0表示，高低是一个相对概念

> 设备：中继器、集线器、双绞线



# HTTP

HTTP是应用层的协议，HTTP协议是建立在TCP协议基础之上的。**WEB使用HTTP协议作为应用层协议，以封装HTTP文本信息，然后使用TCP/IP做传输协议将它发送到网络上**。

